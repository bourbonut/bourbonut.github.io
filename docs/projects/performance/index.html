<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Benjamin Bourbon">
<meta name="dcterms.date" content="2023-01-20">

<title>Blog - Computation of the sum of prime numbers in different languages</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Blog</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../projects.html">
 <span class="menu-text">Projects</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">
 <span class="menu-text">Benjamin Bourbon</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/bourbonut"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/benjamin-bourbon-84a6751b8/"><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Computation of the sum of prime numbers in different languages</h1>
  <div class="quarto-categories">
    <div class="quarto-category">computing</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Benjamin Bourbon </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 20, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="description" class="level1">
<h1>Description</h1>
<p>The project allows to see the difference of speed of program’s execution between multiple languages with one algorithm which computes the sum of prime numbers. Also, the goal is to use native libraries for each language.</p>
<p>Here is the <a href="https://stackoverflow.com/questions/4057527/need-help-optimizing-algorithm-sum-of-all-prime-numbers-under-two-million">source of the algorithm</a></p>
</section>
<section id="code" class="level1">
<h1>Code</h1>
<script src="https://d3js.org/d3.v4.js"></script>
<p><input id="python-button" type="button" value="Python" style="color:white; text-decoration:none; border:none; border-bottom: white 1px solid;" onclick="select_language('python');"> <input id="rust-button" type="button" value="Rust" style="color:white; text-decoration:none; border:none; border-bottom: white 1px solid;" onclick="select_language('rust');"> <input id="cpp-button" type="button" value="C++" style="color:white; text-decoration:none; border:none; border-bottom: white 1px solid;" onclick="select_language('cpp');"> <input id="elixir-button" type="button" value="Elixir" style="color:white; text-decoration:none; border:none; border-bottom: white 1px solid;" onclick="select_language('elixir');"> <input id="java-button" type="button" value="Java" style="color:white; text-decoration:none; border:none; border-bottom: white 1px solid;" onclick="select_language('java');"> <input id="lua-button" type="button" value="Lua" style="color:white; text-decoration:none; border:none; border-bottom: white 1px solid;" onclick="select_language('lua');"> <input id="javascript-button" type="button" value="Javascript" style="color:white; text-decoration:none; border:none; border-bottom: white 1px solid;" onclick="select_language('javascript');"> <input id="scala-button" type="button" value="Scala" style="color:white; text-decoration:none; border:none; border-bottom: white 1px solid;" onclick="select_language('scala');"></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> time <span class="im">import</span> perf_counter</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> chrono(function):</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> inner(<span class="op">*</span>args):</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        start <span class="op">=</span> perf_counter()</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> function(<span class="op">*</span>args)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        duration <span class="op">=</span> perf_counter() <span class="op">-</span> start</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"</span><span class="sc">%0.3f</span><span class="st"> x 10e(-3) seconds"</span> <span class="op">%</span> (duration <span class="op">*</span> <span class="dv">1_000</span>))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> inner</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># @chrono</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> P10(n):</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> <span class="bu">int</span>(n <span class="op">**</span> <span class="fl">0.5</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> r <span class="op">*</span> r <span class="op">&lt;=</span> n <span class="kw">and</span> (r <span class="op">+</span> <span class="dv">1</span>) <span class="op">**</span> <span class="dv">2</span> <span class="op">&gt;</span> n</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    V <span class="op">=</span> [n <span class="op">//</span> i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, r <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    V <span class="op">+=</span> <span class="bu">list</span>(<span class="bu">range</span>(V[<span class="op">-</span><span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span>, <span class="dv">0</span>, <span class="op">-</span><span class="dv">1</span>))</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    S <span class="op">=</span> {i: i <span class="op">*</span> (i <span class="op">+</span> <span class="dv">1</span>) <span class="op">//</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span> <span class="cf">for</span> i <span class="kw">in</span> V}</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">2</span>, r <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> S[p] <span class="op">&gt;</span> S[p <span class="op">-</span> <span class="dv">1</span>]:  <span class="co"># p is prime</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            sp <span class="op">=</span> S[p <span class="op">-</span> <span class="dv">1</span>]  <span class="co"># sum of primes smaller than p</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>            p2 <span class="op">=</span> p <span class="op">*</span> p</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> v <span class="kw">in</span> V:</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> v <span class="op">&lt;</span> p2:</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>                S[v] <span class="op">-=</span> p <span class="op">*</span> (S[v <span class="op">//</span> p] <span class="op">-</span> sp)</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> S[n]</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> _format(dist, value):</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> value <span class="op">+</span> <span class="st">" "</span> <span class="op">*</span> (dist <span class="op">-</span> <span class="bu">len</span>(value))</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Power | Time (µs) | Resultat"</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"========================================"</span>)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">9</span>):</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    start <span class="op">=</span> perf_counter()</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> P10(<span class="dv">10</span> <span class="op">**</span> i)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    duration <span class="op">=</span> <span class="bu">int</span>((perf_counter() <span class="op">-</span> start) <span class="op">*</span> <span class="dv">1_000_000</span>)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(_format(<span class="dv">5</span>, <span class="bu">str</span>(i)) <span class="op">+</span> <span class="st">" | "</span> <span class="op">+</span> _format(<span class="dv">9</span>, <span class="bu">str</span>(duration)) <span class="op">+</span> <span class="st">" | "</span> <span class="op">+</span> <span class="bu">str</span>(result))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode rust code-with-copy"><code class="sourceCode rust"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::collections::</span>HashMap<span class="op">;</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::time::</span>Instant<span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> Dict <span class="op">=</span> HashMap<span class="op">&lt;</span><span class="dt">u64</span><span class="op">,</span> <span class="dt">u128</span><span class="op">&gt;;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> get_keys(n<span class="op">:</span> <span class="dt">u64</span><span class="op">,</span> half_size<span class="op">:</span> <span class="dt">u64</span>) <span class="op">-&gt;</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u64</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Calculation of keys used in the HashMap</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> v<span class="op">:</span> <span class="dt">Vec</span><span class="op">&lt;</span><span class="dt">u64</span><span class="op">&gt;</span> <span class="op">=</span> <span class="dt">Vec</span><span class="pp">::</span>new()<span class="op">;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="dv">0</span><span class="op">..</span>half_size <span class="op">+</span> <span class="dv">1</span> <span class="op">{</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>        v<span class="op">.</span>push(n <span class="op">/</span> (i <span class="op">+</span> <span class="dv">1</span>))<span class="op">;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> v_max <span class="op">=</span> v[half_size <span class="kw">as</span> <span class="dt">usize</span>]<span class="op">;</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> (<span class="dv">1</span><span class="op">..</span>v_max)<span class="op">.</span>rev() <span class="op">{</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>        v<span class="op">.</span>push(i)<span class="op">;</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    v</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> get_sums(keys<span class="op">:</span> <span class="op">&amp;</span>[<span class="dt">u64</span>]) <span class="op">-&gt;</span> Dict <span class="op">{</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Initialisation du hashmap</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> hmap <span class="op">=</span> <span class="pp">HashMap::</span>new()<span class="op">;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> key <span class="kw">in</span> keys<span class="op">.</span>iter() <span class="op">{</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> big_key <span class="op">=</span> <span class="op">*</span>key <span class="kw">as</span> <span class="dt">u128</span><span class="op">;</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> value <span class="op">=</span> (big_key <span class="op">*</span> (big_key <span class="op">+</span> <span class="dv">1</span>)) <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>        hmap<span class="op">.</span>insert(<span class="op">*</span>key<span class="op">,</span> value)<span class="op">;</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    hmap</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> calculate_sums(<span class="kw">mut</span> hmap<span class="op">:</span> Dict<span class="op">,</span> keys<span class="op">:</span> <span class="op">&amp;</span>[<span class="dt">u64</span>]<span class="op">,</span> square_n<span class="op">:</span> <span class="dt">u64</span>) <span class="op">-&gt;</span> Dict <span class="op">{</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> <span class="dv">2</span><span class="op">..</span>square_n <span class="op">+</span> <span class="dv">1</span> <span class="op">{</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> current_sum <span class="op">=</span> hmap[<span class="op">&amp;</span>(p <span class="op">-</span> <span class="dv">1</span>)]<span class="op">;</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> hmap[<span class="op">&amp;</span>p] <span class="op">&gt;</span> current_sum <span class="op">{</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>            <span class="kw">let</span> p_square <span class="op">=</span> p <span class="op">*</span> p<span class="op">;</span></span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> key <span class="kw">in</span> keys<span class="op">.</span>iter() <span class="op">{</span></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="op">*</span>key <span class="op">&lt;</span> p_square <span class="op">{</span></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span><span class="op">;</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> new_value <span class="op">=</span> hmap[<span class="op">&amp;</span>key] <span class="op">-</span> (p <span class="kw">as</span> <span class="dt">u128</span>) <span class="op">*</span> (hmap[<span class="op">&amp;</span>(key <span class="op">/</span> p)] <span class="op">-</span> current_sum)<span class="op">;</span></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>                hmap<span class="op">.</span>insert(<span class="op">*</span>key<span class="op">,</span> new_value)<span class="op">;</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>    hmap</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> primes(n<span class="op">:</span> <span class="dt">u64</span>) <span class="op">-&gt;</span> <span class="dt">u128</span> <span class="op">{</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> square_n <span class="op">=</span> (n <span class="kw">as</span> <span class="dt">f64</span>)<span class="op">.</span>sqrt() <span class="kw">as</span> <span class="dt">u64</span><span class="op">;</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>    <span class="pp">assert!</span>(square_n <span class="op">*</span> square_n <span class="op">&lt;=</span> n <span class="op">&amp;&amp;</span> (square_n <span class="op">+</span> <span class="dv">1</span>)<span class="op">.</span>pow(<span class="dv">2</span>) <span class="op">&gt;</span> n)<span class="op">;</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> half_size <span class="op">=</span> square_n <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> keys <span class="op">=</span> get_keys(n<span class="op">,</span> half_size)<span class="op">;</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> p_keys <span class="op">=</span> <span class="op">&amp;</span>keys<span class="op">;</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> all_sums <span class="op">=</span> get_sums(p_keys)<span class="op">;</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>    all_sums <span class="op">=</span> calculate_sums(all_sums<span class="op">,</span> p_keys<span class="op">,</span> square_n)<span class="op">;</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>    all_sums[<span class="op">&amp;</span>n]</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> format(dist<span class="op">:</span> <span class="dt">usize</span><span class="op">,</span> value<span class="op">:</span> <span class="op">&amp;</span><span class="dt">String</span>) <span class="op">-&gt;</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="kw">mut</span> v<span class="op">:</span> <span class="dt">String</span> <span class="op">=</span> value<span class="op">.</span>to_string()<span class="op">;</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _ <span class="kw">in</span> <span class="dv">1</span><span class="op">..</span>(dist <span class="op">-</span> (<span class="op">*</span>value)<span class="op">.</span>len()) <span class="op">{</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>        v <span class="op">+=</span> <span class="op">&amp;</span><span class="st">" "</span><span class="op">;</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> v<span class="op">;</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">"Power | Time (µs) | Resultat"</span>)<span class="op">;</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">"========================================"</span>)<span class="op">;</span></span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="dv">1</span><span class="op">..</span><span class="dv">9</span> <span class="op">{</span></span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> now <span class="op">=</span> <span class="pp">Instant::</span>now()<span class="op">;</span></span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> n<span class="op">:</span> <span class="dt">u64</span> <span class="op">=</span> (<span class="dv">10_u64</span>)<span class="op">.</span>pow(i)<span class="op">;</span></span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> value<span class="op">:</span> <span class="dt">u128</span> <span class="op">=</span> primes(n)<span class="op">;</span></span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> new_now <span class="op">=</span> <span class="pp">Instant::</span>now()<span class="op">;</span></span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>        <span class="pp">println!</span>(</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>            <span class="st">"{} | {} | {}"</span><span class="op">,</span></span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>            format(<span class="dv">6</span><span class="op">,</span> <span class="op">&amp;</span>(i<span class="op">.</span>to_string()))<span class="op">,</span></span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>            format(<span class="dv">10</span><span class="op">,</span> <span class="op">&amp;</span>(new_now<span class="op">.</span>duration_since(now)<span class="op">.</span>as_micros()<span class="op">.</span>to_string()))<span class="op">,</span></span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>            value</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>        )<span class="op">;</span></span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp code-with-copy"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cstdio&gt;</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;cmath&gt;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;assert.h&gt;</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;unordered_map&gt;</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;chrono&gt;</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string&gt;</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> <span class="bu">std::</span>chrono<span class="op">;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="kw">using</span> <span class="kw">namespace</span> std<span class="op">;</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> unordered_map<span class="op">&lt;</span><span class="dt">long</span><span class="op">,</span> <span class="dt">long</span> <span class="dt">long</span><span class="op">&gt;</span> umap<span class="op">;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> generate_key_array<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> key_array<span class="op">[],</span> <span class="dt">long</span> <span class="dt">long</span> n<span class="op">,</span> <span class="dt">long</span> half_size<span class="op">){</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="co">// generation of a key array which serves for the dictionary all_sums</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="dt">long</span> <span class="dt">long</span> value<span class="op">;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span><span class="op">(</span><span class="dt">long</span> index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> index <span class="op">&lt;=</span> half_size<span class="op">+</span><span class="dv">1</span><span class="op">;</span> index<span class="op">++){</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    value <span class="op">=</span> <span class="op">(</span><span class="dt">long</span> <span class="dt">long</span><span class="op">)</span> n <span class="op">/</span> <span class="op">(</span>index <span class="op">+</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    key_array<span class="op">[</span>index<span class="op">]</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span><span class="op">(</span><span class="dt">long</span> index <span class="op">=</span> half_size <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> index <span class="op">&lt;</span> <span class="dv">2</span> <span class="op">*</span> half_size <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> index<span class="op">++){</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    value <span class="op">=</span> key_array<span class="op">[</span>index <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    key_array<span class="op">[</span>index<span class="op">]</span> <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> generate_all_sums<span class="op">(</span>umap<span class="op">&amp;</span> all_sums<span class="op">,</span> <span class="dt">long</span> <span class="dt">long</span> key_array<span class="op">[],</span> <span class="dt">long</span> size<span class="op">){</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">// generation of dictionary all_sums</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="dt">long</span> <span class="dt">long</span> value<span class="op">;</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span><span class="op">(</span><span class="dt">long</span> index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> index <span class="op">&lt;</span> size<span class="op">;</span> index<span class="op">++){</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    value <span class="op">=</span> key_array<span class="op">[</span>index<span class="op">];</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="co">// storing sum of numbers for 1 to key</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>    all_sums<span class="op">[</span>value<span class="op">]</span> <span class="op">=</span> <span class="op">((</span><span class="dt">long</span> <span class="dt">long</span><span class="op">)</span> <span class="op">(</span>value<span class="op">*(</span>value <span class="op">+</span> <span class="dv">1</span><span class="op">))/</span><span class="dv">2</span><span class="op">)</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> calculate_new_sums<span class="op">(</span>umap<span class="op">&amp;</span> all_sums<span class="op">,</span> <span class="dt">long</span> <span class="dt">long</span> key_array<span class="op">[],</span> <span class="dt">long</span> <span class="dt">long</span> square_root<span class="op">){</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">// core of the program for calculate the sum of prime numbers</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="dt">long</span> <span class="dt">long</span> current_sum<span class="op">;</span></span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="dt">long</span> <span class="dt">long</span> p_square<span class="op">;</span></span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  <span class="dt">long</span> index<span class="op">;</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  <span class="dt">long</span> <span class="dt">long</span> key<span class="op">;</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  <span class="dt">long</span> <span class="dt">long</span> second_key<span class="op">;</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span><span class="op">(</span><span class="dt">long</span> p <span class="op">=</span> <span class="dv">2</span><span class="op">;</span> p <span class="op">&lt;=</span> square_root<span class="op">;</span> p<span class="op">++){</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>    current_sum <span class="op">=</span> all_sums<span class="op">[</span>p <span class="op">-</span> <span class="dv">1</span><span class="op">];</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>all_sums<span class="op">[</span>p<span class="op">]</span> <span class="op">&gt;</span> current_sum<span class="op">){</span> <span class="co">//if p is prime</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>      p_square <span class="op">=</span> p <span class="op">*</span> p<span class="op">;</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>      index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>      key <span class="op">=</span> key_array<span class="op">[</span>index<span class="op">];</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>      <span class="co">// while the key is lower than p * p</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span><span class="op">(</span>key <span class="op">&gt;=</span> p_square<span class="op">){</span></span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>        second_key <span class="op">=</span> key <span class="op">/</span> p<span class="op">;</span></span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>        <span class="co">// updating the sum of the key 'key'</span></span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>        all_sums<span class="op">[</span>key<span class="op">]</span> <span class="op">-=</span> p <span class="op">*</span> <span class="op">(</span>all_sums<span class="op">[</span>second_key<span class="op">]</span> <span class="op">-</span> current_sum<span class="op">);</span></span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>        index<span class="op">++;</span></span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>        key <span class="op">=</span> key_array<span class="op">[</span>index<span class="op">];</span></span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span></span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> P10<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span> n<span class="op">){</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>  <span class="dt">long</span> <span class="dt">long</span> square_root <span class="op">=</span> <span class="op">(</span><span class="dt">long</span> <span class="dt">long</span><span class="op">)</span> sqrt<span class="op">(</span>n<span class="op">);</span></span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>  <span class="co">//check if the program will work</span></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>  <span class="ot">assert</span> <span class="op">((</span>square_root<span class="op">*</span>square_root <span class="op">&lt;=</span> n<span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="op">((</span>square_root <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span>square_root <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">&gt;</span> n<span class="op">));</span></span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>  <span class="dt">long</span> <span class="dt">long</span> final_sum<span class="op">;</span></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>  <span class="dt">long</span> half_size <span class="op">=</span> square_root <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>  <span class="dt">long</span> <span class="dt">long</span><span class="op">*</span> key_array <span class="op">=</span> <span class="kw">new</span> <span class="dt">long</span> <span class="dt">long</span> <span class="op">[</span>half_size <span class="op">*</span> <span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span><span class="op">];</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>  generate_key_array<span class="op">(</span>key_array<span class="op">,</span> n<span class="op">,</span> half_size<span class="op">);</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>  <span class="dt">long</span> size <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> half_size <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>  <span class="co">// dictionary of sums</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>  umap all_sums<span class="op">;</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>  generate_all_sums<span class="op">(</span>all_sums<span class="op">,</span> key_array<span class="op">,</span> size<span class="op">);</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>  calculate_new_sums<span class="op">(</span>all_sums<span class="op">,</span> key_array<span class="op">,</span> square_root<span class="op">);</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>  final_sum <span class="op">=</span> all_sums<span class="op">[</span>n<span class="op">];</span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a>  <span class="kw">delete</span> key_array<span class="op">;</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>  all_sums<span class="op">.</span>clear<span class="op">();</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> final_sum<span class="op">;</span></span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>string format<span class="op">(</span><span class="dt">int</span> dist<span class="op">,</span> string value<span class="op">){</span></span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>  string hole <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> _<span class="op">=</span><span class="dv">0</span><span class="op">;</span> _<span class="op">&lt;=(</span>dist<span class="op">-(</span><span class="dt">int</span><span class="op">)(</span>value<span class="op">).</span>size<span class="op">());</span> _<span class="op">++){</span></span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>    hole<span class="op">+=</span><span class="st">" "</span><span class="op">;</span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> value <span class="op">+</span> hole<span class="op">;</span></span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(){</span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Goal: 100 000 000 000</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Awaited result: 201 467 077 743 744 681 014</span></span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>  <span class="kw">auto</span> start <span class="op">=</span> high_resolution_clock<span class="op">::</span>now<span class="op">();</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>  <span class="dt">long</span> <span class="dt">long</span> value<span class="op">;</span></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>  cout <span class="op">&lt;&lt;</span> <span class="st">"Power | Time (µs) | Result"</span> <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>  cout <span class="op">&lt;&lt;</span> <span class="st">"========================================"</span> <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span><span class="op">(</span><span class="dt">int</span> i<span class="op">=</span><span class="dv">1</span><span class="op">;</span> i<span class="op">&lt;=</span><span class="dv">8</span><span class="op">;</span> i<span class="op">++){</span></span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>    <span class="co">// cout &lt;&lt; "Power: " &lt;&lt; i &lt;&lt; endl;</span></span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>    value <span class="op">=</span> P10<span class="op">(</span>pow<span class="op">(</span><span class="dv">10</span><span class="op">,</span>i<span class="op">));</span></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> stop <span class="op">=</span> high_resolution_clock<span class="op">::</span>now<span class="op">();</span></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> duration <span class="op">=</span> duration_cast<span class="op">&lt;</span>microseconds<span class="op">&gt;(</span>stop <span class="op">-</span> start<span class="op">);</span></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>    <span class="co">// cout &lt;&lt; value &lt;&lt; endl;</span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>    <span class="co">// cout &lt;&lt; "Time taken by function: " &lt;&lt; duration.count() &lt;&lt; " x 10e(-3) seconds" &lt;&lt; endl;</span></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>    cout <span class="op">&lt;&lt;</span> format<span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="bu">std::</span>to_string<span class="op">(</span>i<span class="op">))</span> <span class="op">&lt;&lt;</span> <span class="st">" | "</span> <span class="op">&lt;&lt;</span> format<span class="op">(</span><span class="dv">8</span><span class="op">,</span> to_string<span class="op">(</span>duration<span class="op">.</span>count<span class="op">()))</span> <span class="op">&lt;&lt;</span> <span class="st">" | "</span> <span class="op">&lt;&lt;</span> value <span class="op">&lt;&lt;</span> endl<span class="op">;</span></span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode elixir code-with-copy"><code class="sourceCode elixir"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Primes</span> <span class="kw">do</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@spec</span> sqrt(integer) :: integer</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> sqrt(n) <span class="kw">do</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    trunc(<span class="va">:math</span><span class="op">.</span>sqrt(n))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@spec</span> head_keys(integer, integer) :: [integer]</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> head_keys(n, root_n) <span class="kw">do</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span><span class="op">..</span>(root_n <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">|&gt;</span> <span class="cn">Enum</span><span class="op">.</span>map(<span class="op">&amp;</span>div(n, <span class="op">&amp;</span><span class="dv">1</span>))</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@spec</span> tail_keys(integer, integer) :: [integer]</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> tail_keys(n, root_n) <span class="kw">do</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Enum</span><span class="op">.</span>to_list(div(n, root_n)<span class="op">..</span><span class="dv">1</span>)</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@spec</span> generate_keys(integer, integer) :: [integer]</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> generate_keys(n, root_n) <span class="kw">do</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>    head_keys(n, root_n) <span class="op">++</span> tail_keys(n, root_n)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@spec</span> n_sums(integer) :: {integer}</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> n_sums(i) <span class="kw">do</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    {i, div(i <span class="op">*</span> (i <span class="op">+</span> <span class="dv">1</span>), <span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span>}</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@spec</span> generate_sums([integer]) :: %{integer <span class="op">=&gt;</span> integer}</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> generate_sums(keys) <span class="kw">do</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Enum</span><span class="op">.</span>into(keys, %{}, <span class="op">&amp;</span>n_sums(<span class="op">&amp;</span><span class="dv">1</span>))</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@spec</span> small(integer, %{integer <span class="op">=&gt;</span> integer}, integer, integer) :: {integer}</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> small(v, dict, p, sp) <span class="kw">do</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    {v, dict[v] <span class="op">-</span> p <span class="op">*</span> (dict[div(v, p)] <span class="op">-</span> sp)}</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@spec</span> calculate(%{integer <span class="op">=&gt;</span> integer}, [integer], integer, integer) :: %{integer <span class="op">=&gt;</span> integer}</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> calculate(sums, keys, p, limit) <span class="kw">when</span> p <span class="op">&lt;</span> limit <span class="kw">do</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    sum_p <span class="op">=</span> sums[p <span class="op">-</span> <span class="dv">1</span>]</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> sums[p] <span class="op">&gt;</span> sum_p <span class="kw">do</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>      <span class="cn">Enum</span><span class="op">.</span>take_while(keys, <span class="op">&amp;</span>(<span class="op">&amp;</span><span class="dv">1</span> <span class="op">&gt;=</span> p <span class="op">*</span> p))</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>      <span class="op">|&gt;</span> <span class="cn">Enum</span><span class="op">.</span>into(%{}, <span class="op">&amp;</span>small(<span class="op">&amp;</span><span class="dv">1</span>, sums, p, sum_p))</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>      <span class="op">|&gt;</span> (<span class="op">&amp;</span><span class="cn">Map</span><span class="op">.</span>merge(sums, <span class="op">&amp;</span><span class="dv">1</span>))<span class="op">.</span>()</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>      <span class="op">|&gt;</span> calculate(keys, p <span class="op">+</span> <span class="dv">1</span>, limit)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>      calculate(sums, keys, p <span class="op">+</span> <span class="dv">1</span>, limit)</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@spec</span> calculate(%{integer <span class="op">=&gt;</span> integer}, [integer], integer, integer) :: %{integer <span class="op">=&gt;</span> integer}</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> calculate(sums, _, p, limit) <span class="kw">when</span> p <span class="op">&gt;=</span> limit <span class="kw">do</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    sums</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@spec</span> sum_up_to(integer) :: integer</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> sum_up_to(n) <span class="kw">do</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>    root_n <span class="op">=</span> sqrt(n)</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>    keys <span class="op">=</span> generate_keys(n, root_n)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    sums <span class="op">=</span> generate_sums(keys)</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>    calculate(sums, keys, <span class="dv">2</span>, root_n <span class="op">+</span> <span class="dv">1</span>)[n]</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@spec</span> measure(function) :: integer</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> measure(function) <span class="kw">do</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>    function</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>    <span class="op">|&gt;</span> <span class="va">:timer</span><span class="op">.</span>tc()</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>    <span class="op">|&gt;</span> elem(<span class="dv">0</span>)</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># divide by 1_000 for milliseconds</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>    <span class="op">|&gt;</span> <span class="cn">Kernel</span><span class="op">./</span>(<span class="dv">1</span>)</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Formatter</span> <span class="kw">do</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@spec</span> add_space(integer, charlist) :: charlist</span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> add_space(<span class="dv">0</span>, string) <span class="kw">do</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>    string</span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@spec</span> add_space(integer, charlist) :: charlist</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> add_space(i, string) <span class="kw">do</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    add_space(i <span class="op">-</span> <span class="dv">1</span>, string <span class="op">&lt;&gt;</span> <span class="st">" "</span>)</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@spec</span> format(integer, integer) :: charlist</span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> format(dist, value) <span class="kw">do</span></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>    string_v <span class="op">=</span> <span class="st">"</span><span class="ot">#{</span>value<span class="ot">}</span><span class="st">"</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>    add_space(dist <span class="op">-</span> <span class="cn">String</span><span class="op">.</span>length(string_v), string_v)</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@spec</span> format_all(integer, integer, integer) :: <span class="cn">nil</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> format_all(power, time, value) <span class="kw">do</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>    <span class="cn">IO</span><span class="op">.</span>puts(<span class="st">"</span><span class="ot">#{</span>format(<span class="dv">5</span>, power)<span class="ot">}</span><span class="st"> | </span><span class="ot">#{</span>format(<span class="dv">9</span>, time)<span class="ot">}</span><span class="st"> | </span><span class="ot">#{</span>value<span class="ot">}</span><span class="st">"</span>)</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a><span class="cn">IO</span><span class="op">.</span>puts(<span class="st">"Power | Time (µs) | Result"</span>)</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a><span class="cn">IO</span><span class="op">.</span>puts(<span class="st">"========================================="</span>)</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a><span class="cn">Primes</span><span class="op">.</span>sum_up_to(<span class="dv">100</span>)</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="op">..</span><span class="dv">8</span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a><span class="op">|&gt;</span> <span class="cn">Enum</span><span class="op">.</span>map(<span class="kw">fn</span> exp <span class="op">-&gt;</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>  f <span class="op">=</span> <span class="cn">Primes</span><span class="op">.</span>measure(<span class="kw">fn</span> <span class="op">-&gt;</span> <span class="cn">Primes</span><span class="op">.</span>sum_up_to(<span class="va">:math</span><span class="op">.</span>pow(<span class="dv">10</span>, exp) <span class="op">|&gt;</span> round) <span class="kw">end</span>)</span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>  <span class="cn">Formatter</span><span class="op">.</span>format_all(exp, f <span class="op">|&gt;</span> round, <span class="cn">Primes</span><span class="op">.</span>sum_up_to(<span class="va">:math</span><span class="op">.</span>pow(<span class="dv">10</span>, exp) <span class="op">|&gt;</span> round))</span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">HashMap</span><span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">Vector</span><span class="op">;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">lang</span><span class="op">.</span><span class="im">Math</span><span class="op">;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> Main<span class="op">{</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="bu">Vector</span><span class="op">&lt;</span><span class="bu">Integer</span><span class="op">&gt;</span> <span class="fu">get_keys</span><span class="op">(</span><span class="bu">Integer</span> n<span class="op">,</span> <span class="bu">Integer</span> half_size<span class="op">){</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Vector</span><span class="op">&lt;</span><span class="bu">Integer</span><span class="op">&gt;</span> V <span class="op">=</span> <span class="kw">new</span> <span class="bu">Vector</span><span class="op">&lt;&gt;();</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="bu">Integer</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> half_size<span class="op">;</span> i<span class="op">++){</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>            V<span class="op">.</span><span class="fu">add</span><span class="op">(</span>n <span class="op">/</span> <span class="op">(</span>i <span class="op">+</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Integer</span> vmax <span class="op">=</span> V<span class="op">.</span><span class="fu">get</span><span class="op">(</span>V<span class="op">.</span><span class="fu">size</span><span class="op">()</span> <span class="op">-</span> <span class="dv">1</span><span class="op">)</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="bu">Integer</span> i <span class="op">=</span> vmax<span class="op">;</span> i <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span> i<span class="op">--){</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>            V<span class="op">.</span><span class="fu">add</span><span class="op">(</span>i<span class="op">);</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> V<span class="op">;</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="bu">HashMap</span><span class="op">&lt;</span><span class="bu">Integer</span><span class="op">,</span> <span class="bu">Long</span><span class="op">&gt;</span> <span class="fu">get_sums</span><span class="op">(</span><span class="bu">Vector</span><span class="op">&lt;</span><span class="bu">Integer</span><span class="op">&gt;</span> keys<span class="op">){</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">HashMap</span><span class="op">&lt;</span><span class="bu">Integer</span><span class="op">,</span> <span class="bu">Long</span><span class="op">&gt;</span> hmap <span class="op">=</span> <span class="kw">new</span> <span class="bu">HashMap</span><span class="op">&lt;&gt;();</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> key<span class="op">:</span> keys<span class="op">){</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>            <span class="dt">long</span> big_key <span class="op">=</span> key<span class="op">;</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>            <span class="dt">long</span> value <span class="op">=</span> <span class="op">(</span>big_key <span class="op">*</span> <span class="op">(</span>big_key <span class="op">+</span> <span class="dv">1</span><span class="op">))</span> <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>            hmap<span class="op">.</span><span class="fu">put</span><span class="op">(</span>key<span class="op">,</span> value<span class="op">);</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> hmap<span class="op">;</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="bu">HashMap</span><span class="op">&lt;</span><span class="bu">Integer</span><span class="op">,</span> <span class="bu">Long</span><span class="op">&gt;</span> <span class="fu">calculate_sums</span><span class="op">(</span><span class="bu">HashMap</span><span class="op">&lt;</span><span class="bu">Integer</span><span class="op">,</span> <span class="bu">Long</span><span class="op">&gt;</span> hmap<span class="op">,</span> <span class="bu">Vector</span><span class="op">&lt;</span><span class="bu">Integer</span><span class="op">&gt;</span> keys<span class="op">,</span> <span class="dt">int</span> square_n<span class="op">){</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="bu">Integer</span> p <span class="op">=</span> <span class="dv">2</span><span class="op">;</span> p <span class="op">&lt;</span> square_n <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> p<span class="op">++){</span></span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>            <span class="dt">long</span> current_sum <span class="op">=</span> hmap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>p <span class="op">-</span> <span class="dv">1</span><span class="op">);</span></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span>hmap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>p<span class="op">)</span> <span class="op">&gt;</span> current_sum<span class="op">){</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>                <span class="dt">long</span> p_square <span class="op">=</span> p <span class="op">*</span> p<span class="op">;</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> key<span class="op">:</span> keys<span class="op">){</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>key <span class="op">&lt;</span> p_square<span class="op">){</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>                    <span class="dt">long</span> new_value <span class="op">=</span> hmap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>key<span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="dt">long</span><span class="op">)</span>p <span class="op">*</span> <span class="op">(</span>hmap<span class="op">.</span><span class="fu">get</span><span class="op">(</span>key <span class="op">/</span> p<span class="op">)</span> <span class="op">-</span> current_sum<span class="op">);</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>                    hmap<span class="op">.</span><span class="fu">put</span><span class="op">(</span>key<span class="op">,</span> new_value<span class="op">);</span></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> hmap<span class="op">;</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="dt">long</span> <span class="fu">primes</span><span class="op">(</span><span class="dt">int</span> n<span class="op">){</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> square_n <span class="op">=</span> <span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">sqrt</span><span class="op">(</span>n<span class="op">);</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> square_n <span class="op">*</span> square_n <span class="op">&lt;=</span> n <span class="op">&amp;&amp;</span> <span class="op">(</span>square_n <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span>square_n <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">&gt;</span> n<span class="op">;</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> half_size <span class="op">=</span> square_n <span class="op">-</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Vector</span><span class="op">&lt;</span><span class="bu">Integer</span><span class="op">&gt;</span> keys <span class="op">=</span> Main<span class="op">.</span><span class="fu">get_keys</span><span class="op">(</span>n<span class="op">,</span> half_size<span class="op">);</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>        <span class="bu">HashMap</span><span class="op">&lt;</span><span class="bu">Integer</span><span class="op">,</span> <span class="bu">Long</span><span class="op">&gt;</span> all_sums <span class="op">=</span> Main<span class="op">.</span><span class="fu">get_sums</span><span class="op">(</span>keys<span class="op">);</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>        all_sums <span class="op">=</span> Main<span class="op">.</span><span class="fu">calculate_sums</span><span class="op">(</span>all_sums<span class="op">,</span> keys<span class="op">,</span> square_n<span class="op">);</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> all_sums<span class="op">.</span><span class="fu">get</span><span class="op">(</span>n<span class="op">);</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="bu">String</span> <span class="fu">format</span><span class="op">(</span><span class="dt">int</span> dist<span class="op">,</span> <span class="bu">String</span> value<span class="op">){</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> value <span class="op">+</span> <span class="st">" "</span><span class="op">.</span><span class="fu">repeat</span><span class="op">(</span>dist <span class="op">-</span> value<span class="op">.</span><span class="fu">length</span><span class="op">());</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span><span class="bu">String</span><span class="op">[]</span> args<span class="op">){</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>        Main App <span class="op">=</span> <span class="kw">new</span> <span class="fu">Main</span><span class="op">();</span></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"Power | Time (µs) | Resultat"</span><span class="op">);</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"========================================"</span><span class="op">);</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>        <span class="fu">primes</span><span class="op">(</span><span class="dv">100</span><span class="op">);</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">9</span><span class="op">;</span> i<span class="op">++){</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>            <span class="dt">long</span> start <span class="op">=</span> <span class="bu">System</span><span class="op">.</span><span class="fu">nanoTime</span><span class="op">();</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>            <span class="dt">long</span> result <span class="op">=</span> <span class="fu">primes</span><span class="op">((</span><span class="dt">int</span><span class="op">)</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span><span class="op">(</span><span class="dv">10</span><span class="op">,</span> i<span class="op">));</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>            <span class="dt">long</span> duration <span class="op">=</span> <span class="op">(</span><span class="bu">System</span><span class="op">.</span><span class="fu">nanoTime</span><span class="op">()</span> <span class="op">-</span> start<span class="op">)</span> <span class="op">/</span> <span class="dv">1_000</span><span class="op">;</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>            <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>                Main<span class="op">.</span><span class="fu">format</span><span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="bu">String</span><span class="op">.</span><span class="fu">valueOf</span><span class="op">(</span>i<span class="op">))</span> <span class="op">+</span> <span class="st">" | "</span> <span class="op">+</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>                Main<span class="op">.</span><span class="fu">format</span><span class="op">(</span><span class="dv">9</span><span class="op">,</span> <span class="bu">String</span><span class="op">.</span><span class="fu">valueOf</span><span class="op">(</span>duration<span class="op">))</span> <span class="op">+</span> <span class="st">" | "</span> <span class="op">+</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>                <span class="bu">String</span><span class="op">.</span><span class="fu">valueOf</span><span class="op">(</span>result<span class="op">)</span></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>            <span class="op">);</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode lua code-with-copy"><code class="sourceCode lua"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> P10<span class="op">(</span>n<span class="op">)</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> <span class="fu">math.floor</span><span class="op">(</span>n<span class="op">^</span><span class="dv">0.5</span><span class="op">)</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">assert</span><span class="op">(</span>r <span class="op">*</span> r <span class="op">&lt;=</span> n <span class="kw">and</span> <span class="op">(</span>r <span class="op">+</span> <span class="dv">1</span><span class="op">)^</span><span class="dv">2</span> <span class="op">&gt;</span> n<span class="op">)</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="cn">V</span> <span class="op">=</span> <span class="op">{}</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> r <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span> <span class="cf">do</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">table.insert</span><span class="op">(</span><span class="cn">V</span><span class="op">,</span> n <span class="op">//</span> i<span class="op">)</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="op">=</span> <span class="cn">V</span><span class="op">[#</span><span class="cn">V</span><span class="op">]</span> <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span> <span class="cf">do</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">table.insert</span><span class="op">(</span><span class="cn">V</span><span class="op">,</span> i<span class="op">)</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="cn">S</span> <span class="op">=</span> <span class="op">{}</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="cn">_</span><span class="op">,</span> i <span class="kw">in</span> <span class="fu">ipairs</span><span class="op">(</span><span class="cn">V</span><span class="op">)</span> <span class="cf">do</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>        <span class="cn">S</span><span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">*</span> <span class="op">(</span>i <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="op">//</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="op">=</span> <span class="dv">2</span><span class="op">,</span> r<span class="op">,</span> <span class="dv">1</span> <span class="cf">do</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="cn">S</span><span class="op">[</span>p<span class="op">]</span> <span class="op">&gt;</span> <span class="cn">S</span><span class="op">[</span>p <span class="op">-</span> <span class="dv">1</span><span class="op">]</span> <span class="cf">then</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>            sp <span class="op">=</span> <span class="cn">S</span><span class="op">[</span>p <span class="op">-</span> <span class="dv">1</span><span class="op">]</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>            p2 <span class="op">=</span> p <span class="op">*</span> p</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="cn">_</span><span class="op">,</span> v <span class="kw">in</span> <span class="fu">ipairs</span><span class="op">(</span><span class="cn">V</span><span class="op">)</span> <span class="cf">do</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> v <span class="op">&lt;</span> p2 <span class="cf">then</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>                <span class="cf">end</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>                <span class="cn">S</span><span class="op">[</span>v<span class="op">]</span> <span class="op">=</span> <span class="cn">S</span><span class="op">[</span>v<span class="op">]</span> <span class="op">-</span> p <span class="op">*</span> <span class="op">(</span><span class="cn">S</span><span class="op">[</span>v <span class="op">//</span> p<span class="op">]</span> <span class="op">-</span> sp<span class="op">)</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>            <span class="cf">end</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">end</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="cn">S</span><span class="op">[</span>n<span class="op">]</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">format</span><span class="op">(</span>dist<span class="op">,</span> value<span class="op">)</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> value <span class="op">..</span> <span class="fu">string.rep</span><span class="op">(</span><span class="st">" "</span><span class="op">,</span> <span class="op">(</span>dist <span class="op">-</span> <span class="fu">string.len</span><span class="op">(</span>value<span class="op">)))</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="st">"Power | Time (µs) | Resultat"</span><span class="op">)</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span><span class="op">(</span><span class="st">"========================================"</span><span class="op">)</span></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">1</span> <span class="cf">do</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    start <span class="op">=</span> <span class="fu">os.clock</span><span class="op">()</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> P10<span class="op">(</span><span class="fu">math.floor</span><span class="op">(</span><span class="dv">10</span><span class="op">^</span>i<span class="op">))</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    duration <span class="op">=</span> <span class="fu">math.floor</span><span class="op">((</span><span class="fu">os.clock</span><span class="op">()</span> <span class="op">-</span> start<span class="op">)</span> <span class="op">*</span> <span class="dv">10</span><span class="op">^</span><span class="dv">6</span><span class="op">)</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span><span class="op">(</span><span class="fu">format</span><span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="fu">tostring</span><span class="op">(</span>i<span class="op">))</span> <span class="op">..</span> <span class="st">" | "</span> <span class="op">..</span> <span class="fu">format</span><span class="op">(</span><span class="dv">9</span><span class="op">,</span> <span class="fu">tostring</span><span class="op">(</span>duration<span class="op">))</span> <span class="op">..</span> <span class="st">" | "</span> <span class="op">..</span> <span class="fu">tostring</span><span class="op">(</span>result<span class="op">))</span></span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript code-with-copy"><code class="sourceCode javascript"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> {<span class="bu">performance</span>} <span class="op">=</span> <span class="pp">require</span>(<span class="st">"perf_hooks"</span>)<span class="op">;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">P10</span>(n){</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> r <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(n <span class="op">**</span> <span class="fl">0.5</span>)<span class="op">;</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">assert</span>(r <span class="op">*</span> r <span class="op">&lt;=</span> n <span class="op">&amp;&amp;</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(r <span class="op">+</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span>) <span class="op">&gt;</span> n)<span class="op">;</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> V <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> r <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> i<span class="op">++</span>){</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        V<span class="op">.</span><span class="fu">push</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(n <span class="op">/</span> i))<span class="op">;</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> V[V<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>] <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span> i<span class="op">--</span>){</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        V<span class="op">.</span><span class="fu">push</span>(i)<span class="op">;</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> S <span class="op">=</span> V<span class="op">.</span><span class="fu">reduce</span>((S<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>        S[i] <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(i <span class="op">*</span> (i <span class="op">+</span> <span class="dv">1</span>) <span class="op">/</span> <span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> S<span class="op">;</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> {})<span class="op">;</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> length <span class="op">=</span> V<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> p <span class="op">=</span> <span class="dv">2</span><span class="op">;</span> p <span class="op">&lt;</span> r <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> p<span class="op">++</span>){</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (S[p] <span class="op">&gt;</span> S[p <span class="op">-</span> <span class="dv">1</span>]) {</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> sp <span class="op">=</span> S[p <span class="op">-</span> <span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">var</span> p2 <span class="op">=</span> p <span class="op">*</span> p<span class="op">;</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> (<span class="kw">let</span> index <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> index <span class="op">&lt;</span> length<span class="op">;</span> index<span class="op">++</span>){</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>                <span class="kw">let</span> v <span class="op">=</span> V[index]<span class="op">;</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> (v <span class="op">&lt;</span> p2){</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span><span class="op">;</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>                S[v] <span class="op">-=</span> p <span class="op">*</span> (S[<span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(v <span class="op">/</span> p)] <span class="op">-</span> sp)<span class="op">;</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> S[n]<span class="op">;</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">format</span>(dist<span class="op">,</span> value){</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> value <span class="op">+</span> <span class="st">" "</span><span class="op">.</span><span class="fu">repeat</span>(dist <span class="op">-</span> value<span class="op">.</span><span class="at">length</span>)</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Power | Time (µs) | Resultat"</span>)</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"========================================"</span>)</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="fu">P10</span>(<span class="dv">100</span>)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (<span class="kw">let</span> i<span class="op">=</span><span class="dv">1</span><span class="op">;</span> i<span class="op">&lt;</span><span class="dv">9</span><span class="op">;</span> i<span class="op">++</span>){</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> start <span class="op">=</span> <span class="bu">performance</span><span class="op">.</span><span class="fu">now</span>()<span class="op">;</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> result <span class="op">=</span> <span class="fu">P10</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(<span class="bu">Math</span><span class="op">.</span><span class="fu">pow</span>(<span class="dv">10</span><span class="op">,</span> i)))<span class="op">;</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    <span class="kw">var</span> duration <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>((<span class="bu">performance</span><span class="op">.</span><span class="fu">now</span>() <span class="op">-</span> start) <span class="op">*</span> <span class="dv">1_000</span>)<span class="op">;</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="fu">format</span>(<span class="dv">5</span><span class="op">,</span> <span class="bu">String</span>(i)) <span class="op">+</span> <span class="st">" | "</span> <span class="op">+</span> <span class="fu">format</span>(<span class="dv">9</span><span class="op">,</span> <span class="bu">String</span>(duration)) <span class="op">+</span> <span class="st">" | "</span> <span class="op">+</span> <span class="bu">String</span>(result))<span class="op">;</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> scala<span class="op">.</span>collection<span class="op">.</span>mutable<span class="op">.</span><span class="ex">HashMap</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> scala<span class="op">.</span>collection<span class="op">.</span>immutable<span class="op">.</span><span class="ex">Vector</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> scala<span class="op">.</span>math<span class="op">.</span>sqrt</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> scala<span class="op">.</span>math<span class="op">.</span>pow</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> scala<span class="op">.</span>math<span class="op">.</span>BigInt</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">get_keys</span><span class="op">(</span>n<span class="op">:</span> <span class="ex">Long</span><span class="op">,</span> half_size<span class="op">:</span><span class="ex">Long</span><span class="op">):</span> <span class="ex">Vector</span><span class="op">[</span><span class="ex">Long</span><span class="op">]</span> <span class="op">=</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> v <span class="op">=</span> <span class="ex">Vector</span><span class="op">.</span><span class="fu">range</span><span class="op">(</span>0L<span class="op">,</span> half_size <span class="op">+</span> 1L<span class="op">).</span><span class="fu">map</span><span class="op">(</span>i <span class="op">=&gt;</span> n <span class="op">/</span> <span class="op">(</span>i <span class="op">+</span> <span class="dv">1</span><span class="op">))</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> vmax <span class="op">=</span> <span class="fu">v</span><span class="op">(</span>half_size<span class="op">.</span>asInstanceOf<span class="op">[</span><span class="bu">Int</span><span class="op">])</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  v <span class="op">++</span> <span class="ex">Vector</span><span class="op">.</span><span class="fu">range</span><span class="op">(</span>1L<span class="op">,</span> vmax<span class="op">).</span>reverse</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">get_sums</span><span class="op">(</span>keys<span class="op">:</span> <span class="ex">Vector</span><span class="op">[</span><span class="ex">Long</span><span class="op">])</span> <span class="op">:</span> <span class="ex">HashMap</span><span class="op">[</span><span class="ex">Long</span><span class="op">,</span> BigInt<span class="op">]</span> <span class="op">=</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> hmap <span class="op">=</span> <span class="ex">HashMap</span><span class="op">.</span>empty<span class="op">[</span><span class="ex">Long</span><span class="op">,</span> BigInt<span class="op">]</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> key <span class="op">&lt;-</span> keys <span class="cf">do</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> k <span class="op">=</span> <span class="fu">BigInt</span><span class="op">(</span>key<span class="op">)</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> value <span class="op">=</span> <span class="op">(</span>k <span class="op">*</span> <span class="op">(</span>k <span class="op">+</span> <span class="dv">1</span><span class="op">))</span> <span class="op">/</span> <span class="dv">2</span> <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    hmap<span class="op">.</span><span class="fu">put</span><span class="op">(</span>key<span class="op">,</span> value<span class="op">)</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  hmap </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">calculate_sums</span><span class="op">(</span>hmap<span class="op">:</span> <span class="ex">HashMap</span><span class="op">[</span><span class="ex">Long</span><span class="op">,</span> BigInt<span class="op">],</span> keys<span class="op">:</span> <span class="ex">Vector</span><span class="op">[</span><span class="ex">Long</span><span class="op">],</span> square_n<span class="op">:</span> <span class="ex">Long</span><span class="op">):</span> <span class="ex">HashMap</span><span class="op">[</span><span class="ex">Long</span><span class="op">,</span> BigInt<span class="op">]</span> <span class="op">=</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> cmap <span class="op">=</span> hmap<span class="op">.</span><span class="fu">clone</span><span class="op">()</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> p <span class="op">&lt;-</span> <span class="op">(</span>2L to square_n<span class="op">)</span> <span class="cf">do</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> current_sum <span class="op">=</span> <span class="fu">cmap</span><span class="op">(</span>p <span class="op">-</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span><span class="fu">cmap</span><span class="op">(</span>p<span class="op">)</span> <span class="op">&gt;</span> current_sum<span class="op">)</span> <span class="op">{</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>      <span class="kw">val</span> p_square <span class="op">=</span> p <span class="op">*</span> p</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> key <span class="op">&lt;-</span> keys<span class="op">.</span><span class="fu">takeWhile</span><span class="op">(</span>p <span class="op">=&gt;</span> p <span class="op">&gt;=</span> p_square<span class="op">)</span> <span class="cf">do</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">val</span> new_value <span class="op">=</span> <span class="fu">cmap</span><span class="op">(</span>key<span class="op">)</span> <span class="op">-</span> p <span class="op">*</span> <span class="op">(</span><span class="fu">cmap</span><span class="op">(</span>key <span class="op">/</span> p<span class="op">)</span> <span class="op">-</span> current_sum<span class="op">)</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>        cmap<span class="op">.</span><span class="fu">update</span><span class="op">(</span>key<span class="op">,</span> new_value<span class="op">)</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>  cmap</span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">primes</span><span class="op">(</span>n<span class="op">:</span> <span class="ex">Long</span><span class="op">):</span> BigInt <span class="op">=</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> square_n <span class="op">=</span> <span class="fu">sqrt</span><span class="op">(</span>n<span class="op">.</span>asInstanceOf<span class="op">[</span><span class="ex">Float</span><span class="op">]).</span>asInstanceOf<span class="op">[</span><span class="ex">Long</span><span class="op">]</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> half_size <span class="op">=</span> square_n <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> keys <span class="op">=</span> <span class="fu">get_keys</span><span class="op">(</span>n<span class="op">,</span> half_size<span class="op">)</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  <span class="kw">var</span> all_sums <span class="op">=</span> <span class="fu">get_sums</span><span class="op">(</span>keys<span class="op">)</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  all_sums <span class="op">=</span> <span class="fu">calculate_sums</span><span class="op">(</span>all_sums<span class="op">,</span> keys<span class="op">,</span> square_n<span class="op">)</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">all_sums</span><span class="op">(</span>n<span class="op">)</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">add_space</span><span class="op">(</span>i<span class="op">:</span><span class="bu">Int</span><span class="op">,</span> string<span class="op">:</span><span class="ex">String</span><span class="op">)</span> <span class="op">:</span> <span class="ex">String</span> <span class="op">=</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">0</span><span class="op">){</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> string</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">add_space</span><span class="op">(</span>i <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> string<span class="op">.</span><span class="fu">concat</span><span class="op">(</span><span class="st">" "</span><span class="op">))</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> <span class="fu">format</span><span class="op">(</span>dist<span class="op">:</span><span class="bu">Int</span><span class="op">,</span> string<span class="op">:</span> <span class="ex">String</span><span class="op">):</span> <span class="ex">String</span> <span class="op">=</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_space</span><span class="op">(</span>dist <span class="op">-</span> string<span class="op">.</span><span class="fu">length</span><span class="op">(),</span> string<span class="op">)</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>@main <span class="kw">def</span> <span class="fu">main</span><span class="op">()</span> <span class="op">=</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  <span class="kw">val</span> result <span class="op">=</span> <span class="fu">primes</span><span class="op">(</span><span class="dv">10</span><span class="op">)</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">println</span><span class="op">(</span><span class="st">"Power | Time (µs) | Resultat"</span><span class="op">)</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">println</span><span class="op">(</span><span class="st">"========================================"</span><span class="op">)</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> power <span class="op">&lt;-</span> <span class="op">(</span><span class="dv">1</span> to <span class="dv">8</span><span class="op">)</span> <span class="cf">do</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> start <span class="op">=</span> <span class="ex">System</span><span class="op">.</span>nanoTime</span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> n <span class="op">=</span> <span class="fu">pow</span><span class="op">(</span><span class="fl">10.0</span><span class="op">,</span> power<span class="op">.</span>asInstanceOf<span class="op">[</span><span class="ex">Double</span><span class="op">]).</span>asInstanceOf<span class="op">[</span><span class="ex">Long</span><span class="op">]</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> result <span class="op">=</span> <span class="fu">primes</span><span class="op">(</span>n<span class="op">)</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>    <span class="kw">val</span> duration <span class="op">=</span> <span class="op">((</span><span class="ex">System</span><span class="op">.</span>nanoTime <span class="op">-</span> start<span class="op">)</span> <span class="op">/</span> <span class="fl">1e3d</span><span class="op">).</span>asInstanceOf<span class="op">[</span><span class="bu">Int</span><span class="op">]</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>    <span class="fu">println</span><span class="op">(</span><span class="ss">s"${</span><span class="fu">format</span><span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="ss">s"$power"</span><span class="op">)</span><span class="ss">}</span><span class="st"> | </span><span class="ss">${</span><span class="fu">format</span><span class="op">(</span><span class="dv">9</span><span class="op">,</span> <span class="ss">s"$duration"</span><span class="op">)</span><span class="ss">}</span><span class="st"> | </span><span class="ss">$result"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="graph" class="level1">
<h1>Graph</h1>
<p>The first graph is the execution time (in <span class="math inline">\(s\)</span>) given the power of <span class="math inline">\(10^x\)</span>. The second graph is the execution time (in <span class="math inline">\(\log(s)\)</span>) after the application of the logarithm function given the power of <span class="math inline">\(10^x\)</span>. You can interact with the legend (for instance, click on <code>elixir</code>).</p>
<div id="standard">

</div>
<div id="logarithmic">

</div>
</section>
<section id="notes" class="level1">
<h1>Notes</h1>
<p>The idea comes from the challenge Euler problem n°245 where one part of the problem involves to compute the sum of prime numbers up to <span class="math inline">\(10^{11}\)</span>.</p>
<p><a href="https://github.com/bourbonut/prime_numbers_sum">GitHub Repository</a></p>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="plot.js"></script>
<script src="selection.js"></script>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center">Copyright 2023, Bourbon Benjamin</div>
  </div>
</footer>



</body></html>